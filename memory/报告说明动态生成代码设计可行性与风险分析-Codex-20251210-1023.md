# 报告说明动态生成代码设计可行性与风险分析

## 可行性评估
- 技术可行：统一渲染函数 + 各报告模块传递上下文的模式简单清晰，与现有报告生成流程兼容；新增 IC 对照为可选审计，不改主报告。
- 工作量可控：主要是新增渲染函数、在 5 个报告模块收集上下文并调用；日志提示与复利校验段精简属于低风险改动。
- 可读性与一致性：集中渲染可保持口径一致，避免手写说明；动态取配置/结果可减少失真。
- 性能影响可忽略：说明区渲染开销极小；IC 对照默认关闭，不增加耗时。

## 主要风险点
1) 说明与实际不一致  
   - 风险：若上下文传值缺漏/错误，说明区与真实计算不符，误导读者。  
   - 缓解：统一从配置/运行结果读取；缺失项标注“未开启/未生成”；增加最小字段校验（例如日志路径/结果数为空时提示警告）。

2) 多模块接入遗漏  
   - 风险：某些报告未调用渲染函数，导致部分报告无说明。  
   - 缓解：明确需要接入的 5 个模块（单因子非参、带参数 10 等分、单因子自由区间、双因子非参、双因子带参），逐一打勾验证。

3) 布局/排版影响  
   - 风险：新增说明区可能拉长页面或影响现有样式。  
   - 缓解：使用轻量表格+列表样式，放置在末尾；若影响排版，可通过内部开关暂时隐藏。

4) IC 对照的误用/解读风险  
   - 风险：启用后差异较大，用户误以为主口径变化。  
   - 缓解：默认关闭；说明区明确“仅审计，不影响主报告”；文件放 `baogao/jianyan`。

5) 日志修改不彻底  
   - 风险：仍有重复的复利校验段，或新提示缺失。  
   - 缓解：检查日志开头是否有年化口径提示，确认旧段落已移除/合并。

## 建议的落地顺序（简要）
1) 在 `fa_report_utils.py` 实现 `render_report_notes`，支持空/未启用提示。  
2) 各报告模块收集上下文并在末尾调用渲染函数（5 处逐一验证）。  
3) 日志：增加年化口径提示，删除重复复利校验段。  
4) IC 对照开关与审计 CSV（默认 False），说明区同步状态。  
5) 跑一次全流程，检查 5 份 HTML 末尾的说明区是否完整、口径一致，日志是否降噪；可选开启 IC 对照验证 CSV 生成。  
