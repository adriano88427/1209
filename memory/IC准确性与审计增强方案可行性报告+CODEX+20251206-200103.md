# IC 准确性与审计增强方案可行性报告

## 方案概述
- 引入可选开关：日 IC 加权、强制单日模式、日期+标的去重、收益限尾、独立唯一值阈值。
- 提升审计：输出去重/限尾/样本模式/阈值来源、加权 vs 等权 IC、跳过原因、板块覆盖、raw vs neutral 对比、IC 裁剪范围。
- 保持默认行为不变（开关缺省关闭），回退简单。

## 可行性分析
### 技术实现
- 配置层（`fa_config.py`）：新增布尔/列表/分位数配置，读取逻辑与现有配置一致，影响范围集中。
- 核心计算（`fa_nonparam_analysis.py::calculate_ic`）：已有审计框架（`FA_AUDIT_LOG`），可在现有分支中插入去重、加权、winsor、单日模式、独立唯一值阈值判定，影响局部，易控。
- 报告/汇总：新增加权 IC 列可选输出；不改动原有字段以免兼容性问题。

### 性能/风险
- 性能：去重/限尾/加权均为轻量操作，对当前 2 万行规模影响可忽略；日志在审计开启时增加输出，默认关闭无额外开销。
- 行为兼容：默认开关关闭，沿用等权+拼窗+无去重+无收益限尾的旧逻辑，回退成本低。
- 数据风险缓解：去重避免重复计入；限尾可抑制极端值；加权/单日模式由配置控制，避免强制改变既有结果。

### 与现状契合度
- 现有审计运行显示样本模式为高样本量、缺失/重复极低，方案的开关更偏向“可验证、可对照”，不会破坏已有稳定性。
- 唯一值放宽已生效，新方案允许独立配置以进一步针对离散因子微调。

## 实施建议
1) 配置新增（默认关闭）：`IC_WEIGHTED_DAILY`、`IC_FORCE_SINGLE_DAY`、`IC_DEDUP_KEYS`、`IC_RET_WINSOR`、`IC_UNIQUE_THRESHOLDS`。
2) 计算链路调整：插入去重、可选收益 winsor、单日模式分支、唯一值阈值优先级，加权 IC 写入 `extra_stats`。
3) 审计输出扩充：记录去重行数、限尾比例、模式/阈值来源、加权 vs 等权、跳过原因、板块覆盖、raw/neutral 对比、IC 裁剪范围。
4) 汇总/报告：可选展示 `加权IC均值`，若不展示也在 `extra_stats` 中保留。
5) 验证：开启 `FA_AUDIT_LOG=1`（或 `FA_LOG_VERBOSE=1`）重跑，检查日志与新产物；对比等权/加权、单日/拼窗结果，确认无异常后再按需启用开关。

## 结论
- 方案技术可行、改动局部、回退简单；默认不改变现有结果，提供更强的可观测性与可选的精度提升路径。推荐按步骤实施并在审计模式下验证后再视需要开启相关开关。***
