# 外部基准对比分析报告-Codex-20251208-0015

## 背景
- 目的：用纯 pandas 重算外部基准 IC，与主流程汇总对比，评估“原始 IC 计算准确性”一致性。
- 输入：
  - 主流程汇总：`baogao/因子分析汇总_20251207_175525.csv`
  - 外部基准（纯 pandas）：`baogao/ic_benchmark_external_pandas.csv`（按因子×日期 Spearman IC，等权/样本加权）
  - 对比表：`baogao/ic_benchmark_compare_ext.csv`

## 结果概览（差异）
- 差异范围：IC/加权IC 绝对差约在 ±0.006 内（按日样本数、因子/收益唯一值过滤后计算）。
- 示例（IC差异 / 加权差异）：
  - 当日回调：+0.0059 / +0.00143
  - 机构持股比例(%)：+0.0033 / +0.00045
  - 流通市值(元)：-0.0038 / -0.00022
  - 朋友合计（企业大股东（大非）+社保+保险）：-0.0021 / +0.00015
  - 十大流通机构小非：+0.0060 / +0.00029

## 全量因子对比
- 字段：`IC均值`、`加权IC均值`（主流程）、`IC均值_external`、`加权IC均值_external`（纯 pandas 基准）、差值（主-外部）。
- 摘要表：

| 因子名称 | IC均值 | IC均值_external | IC均值_diff | 加权IC均值 | 加权IC均值_external | 加权IC均值_diff |
| --- | --- | --- | --- | --- | --- | --- |
| 当日回调 | 0.002 | 0.0079 | -0.0059 | 0.013 | 0.0116 | 0.0014 |
| 机构持股比例(%) | -0.005 | -0.0083 | 0.0033 | 0.001 | 0.0006 | 0.0005 |
| 流通市值(元) | 0.033 | 0.0368 | -0.0038 | 0.026 | 0.0262 | -0.0002 |
| 财务投资机构合计... | 0.009 | 0.0092 | -0.0001 | -0.001 | -0.0012 | 0.0002 |
| 朋友合计... | -0.006 | -0.0039 | -0.0021 | -0.001 | -0.0012 | 0.0002 |
| 十大流通个人持股合计 | -0.001 | 0.0013 | -0.0023 | 0.005 | 0.0047 | 0.0003 |
| 高管/大股东持股比例大非 | 0.008 | 0.0097 | -0.0017 | 0.000 | -0.0016 | 0.0016 |
| 普通散户持股比例 | -0.006 | -0.0042 | -0.0018 | 0.003 | 0.0032 | -0.0002 |
| 企业大股东大非（包含国资） | -0.013 | -0.0059 | -0.0071 | 0.002 | 0.0012 | 0.0008 |
| 企业大股东（包含国资）（小非） | 0.017 | 0.0047 | 0.0123 | 0.002 | 0.0013 | 0.0007 |
| 前10大流通股东持股比例合计 | -0.013 | -0.0060 | -0.0070 | -0.002 | -0.0020 | 0.0000 |
| 十大流通股东小非合计 | 0.006 | 0.0072 | -0.0012 | -0.004 | -0.0043 | 0.0003 |
| 十大流通股东大非合计 | -0.003 | 0.0002 | -0.0032 | -0.002 | -0.0018 | -0.0002 |
| 十大流通机构大非 | 0.002 | 0.0015 | 0.0005 | -0.004 | -0.0043 | 0.0003 |
| 十大流通机构小非 | 0.010 | 0.0040 | 0.0060 | 0.002 | 0.0017 | 0.0003 |
| 基金持仓占比 | -0.005 | -0.0031 | -0.0019 | 0.003 | 0.0031 | -0.0001 |
| QFII持仓占比 | 0.000 | -0.0012 | 0.0012 | -0.004 | -0.0040 | 0.0000 |
| 持有基金家数 | 0.009 | 0.0093 | -0.0003 | -0.001 | 0.0012 | -0.0022 |
| 当日最高涨幅 | 0.004 | 0.0039 | 0.0001 | 0.002 | 0.0019 | 0.0001 |
| 次日开盘涨跌幅 | 0.004 | 0.0060 | -0.0020 | 0.002 | 0.0017 | 0.0003 |

（完整见 `baogao/ic_benchmark_compare_ext.csv`）

## 差异可能原因
1. 窗口/拼窗策略不同：主流程在低样本时可能跨日拼窗并按阈值自适应；外部基准逐日独立计算，不拼窗。
2. 过滤与去重差异：主流程包含唯一值/样本阈值、去重键、收益裁剪；外部基准未完全复刻这些规则。
3. 权重策略：主流程内部可能存在与外部基准略有不同的权重或跳过逻辑；外部基准仅按日样本加权。
4. 浮点/排序：微小差异可能来自计算顺序或浮点累积。

## 结论
- 纯 pandas 外部基准与主流程的 IC 差异整体很小（≤约 0.006），未见大幅偏离，当前可视为一致性良好。
- 若需进一步收敛：
  - 在外部基准中复刻主流程的样本/唯一值阈值和去重键；
  - 模拟主流程的跨日拼窗策略，或在外部基准侧添加同样的过滤/裁剪。
  - 将外部基准对比结果并入审计/报告，标注采用“外部基准（纯 pandas）”说明。

## 后续建议
1. 如需更严苛对齐，迭代外部基准脚本以复刻主流程阈值与拼窗逻辑，再重算对比。
2. 若未来提供完整日度价格矩阵，可尝试 Alphalens/Qlib 价格接口，作为额外权威基准。
3. 将 `ic_benchmark_compare_ext.csv` 纳入验证记录，作为独立实现对照。***
