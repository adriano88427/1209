# 带参数双因子深度挖掘设计方案-Codex-20251208-1700（优化版）

## 目标
在保证可复现与可审计的前提下，最大化挖掘高收益的带参数双因子组合，可接受更长运行时间与必要的外部依赖。

## 设计要点（简洁优先 + 覆盖加宽，按当前选项）
- 分档与覆盖：单/双层分档，主档数 8–10 档；Top-K 扩大为“全因子对覆盖”，用户区间可补充，尽量减少漏网之鱼。
- 样本阈值：交叉格下限保持 300（粗细层默认一致）；如需更低仅在配置中显式开启，并在结果标注“样本不足”。
- 排序模式：默认启用综合得分（收益/夏普/回撤/样本量权重默认 40/30/15/15，可配置）；可在配置切回纯收益排序。
- 外部对照：仅开启 pandas 基准复算 Top-N；Alphalens/Qlib 不启用（如需再单独开关）。
- 展示条数：报告“最佳双因子区间”展示条数提升一倍（例如从 10 提升到 20），便于更宽的人工筛选。
- 日志与审计：记录分档、样本量、权重模式、过滤原因、用户区间，保持可回溯。

## 实施步骤
1. 配置扩展：在 `fa_config.py` 增加/简化参数：`PARAM_BINS`（主档数，8–10）、`PARAM_TOPK`（支持全因子对覆盖开关）、`PARAM_MIN_SAMPLES`（默认 300）、`PARAM_SCORE_WEIGHTS`（默认 40/30/15/15，可切换纯收益）、`ENABLE_PARAM_EXTERNAL_BENCH`（pandas 基准）。
2. 分档搜索：单层或可选双层分档（主档 8–10），用样本阈值 300 过滤交叉格；必要时再加细层但保持逻辑简单。
3. 覆盖补充：支持用户自定义区间/组合；自动覆盖全因子对，减少遗漏。
4. 排序输出：默认综合得分（可切回收益）；输出 Top-N 主结果 + Top-N 备选，最佳区间展示条数提升一倍（如 20）。
5. 外部对照：对 Top-N 用 pandas 复算，输出差异对照；不启用 Alphalens/Qlib（如需另行确认后开启）。
6. 报告与审计：在 HTML/CSV/Excel 展示分档、样本、排序模式、用户区间、Top-N 数量；审计记录分档与过滤原因，便于回溯。

## 风险取舍
- 追求挖掘深度为第一优先：允许提高分档上限（如细分 10–20 档）、放宽样本阈值（细层≥150，可选更低）、扩大 Top-K（5–10），并启用缩窗/业务阈值并行/多目标排序/外部基准。
- 风险提示而非限制：在报告中标注样本不足、流动性/成本可执行性，但默认不因风险而禁止搜索。
- 外部依赖可打开：若需要更强背书，允许开启 Alphalens/Qlib，对 Top-N 区间复算；失败再回退。

## 依赖与风险
- 依赖：默认 pandas 基准；可选安装 Alphalens/Qlib（需价格矩阵，安装耗时/可能冲突）。
- 风险：运行时间显著增加；细分箱易出低样本噪声；业务阈值设置不当可能偏移；外部依赖有兼容风险。
- 缓解：开关默认关闭，细分仅作用 Top-K；样本提示+可配置阈值；外部对照仅在需要时启用。

## 预期收益
- 更高分辨率+缩窗试探，降低错过窄区间高收益的概率。
- 多目标与业务阈值并行，兼顾收益/风险/覆盖度。
- 外部基准与审计记录提升可解释性与背书力度。
