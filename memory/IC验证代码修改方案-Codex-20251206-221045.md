# IC验证代码修改方案（基于调整版方案）

## 目标
- 在现有 `fa_ic_validation.py` 基础上补齐统一入口与收尾功能，默认不影响主路径，核心因子优先、输出轻量。

## 实施步骤（代码层面）
1) 统一入口
   - 在 `fa_ic_validation.py` 增加 `run_ic_validation(baseline, target, audit_log=None, core_factors=None, options)`，封装差异表、核心对比、审计摘要调用；支持输出目录参数。
   - 保留 CLI 入口调用该函数。

2) 审计摘要落盘（默认开启）
   - 扩展 `summarize_audit_log`：增加零/负价过滤计数字段（读取日志或预留接口）；输出统一到 `baogao/audit_summary_latest.csv`，支持覆盖/追加模式。

3) 零/负价审计（默认计数剔除，不改值）
   - 在预处理或验证入口处添加检查函数（计数并可选剔除）；通过配置开关控制“仅计数”或“计数+剔除”，默认仅计数+剔除，保持逻辑与现状一致。
   - 将计数写入审计摘要。

4) 外部基准适配（默认关闭）
   - 在 `fa_ic_validation.py` 预留 `compare_with_benchmark(data, factors)` 接口，实际调用时由外部配置提供实现/路径；仅对核心因子运行。
   - 输出 `baogao/ic_benchmark_compare.csv`，当开关关闭时跳过。

5) 核心因子 CI/Bootstrap（默认关闭）
   - 为核心因子实现可选 CI/Bootstrap 计算（可复用现有统计函数或轻量 bootstrap），开关控制，结果输出 `baogao/ic_ci_core_factors.csv`。

6) 覆盖提示
   - 在汇总报告生成处（非本文件）增加轻量覆盖字段/文本（年度覆盖天数、板块占比），不增加新表；保持可选开关，默认开启提示。

## 配置与默认值
- 新增最少量开关，默认关闭：`ENABLE_BENCHMARK=False`，`ENABLE_IC_CI=False`，`ZERO_PRICE_ACTION="count_and_drop"`（仅计数+剔除，非填充）。
- 复用 `fa_config` 读取，可通过环境变量/配置字典注入。

## 输出文件
- `baogao/ic_diff.csv`（或用户指定）
- `baogao/ic_stats_compare.csv`（核心因子对比）
- `baogao/audit_summary_latest.csv`（单一审计摘要，含零价计数）
- （可选）`baogao/ic_benchmark_compare.csv`、`baogao/ic_ci_core_factors.csv`

## 验证与回退
- 验证：开启单一开关做 A/B，对比等权/加权 IC 差异、p 值、审计计数；性能无显著回归。
- 回退：关闭新增开关、跳过外部基准与 CI/Bootstrap，保留差异表与审计摘要；恢复基线配置（无缩尾、可拼窗）。***
