# 带参数单因子深度挖掘方案可行性与风险分析

## 可行性概述
- **技术基础**：沿用现有带参数单因子清洗/评分框架，新增模块（analysis/report）独立实现，挂钩主流程即可，改动面小。
- **配置复用**：数据路径/清洗逻辑与旧流程一致，新增配置集中在 `fa_config.py`，易于管理；开关默认开启，兼容旧报告。
- **算法简洁**：区间生成（等宽/等频、0 值单档、低样本可并档）+ 分位线性评分（收益/夏普/回撤/样本四项），无协同，逻辑清晰。
- **输出独立**：新增 HTML/CSV/XLSX，不影响旧 10 等分报告；可选按因子去重视图并列展示，便于使用。

## 风险点与影响
1) **性能/耗时**：自由区间覆盖面更广，分档数增加会放大计算量。  
   - 影响：运行时间增加、内存占用上升。  
   - 缓解：设 `SINGLE_PARAM_FLEX_DEFAULT_BINS` 和 `MAX_RANGES_PER_FACTOR` 上限；低样本合并减少无效区间；必要时增加 CLI 限制因子数。
2) **数据稀疏**：样本下限=总样本/20，若分布长尾或分档过细，可能大量区间被过滤。  
   - 影响：榜单为空或覆盖不足。  
   - 缓解：日志/报告提示“无满足条件的区间”与过滤统计；支持合并低样本档；可在配置放宽分档数或下限。
3) **分档策略偏差**：等频/等宽在长尾分布可能偏斜，0 值单档进一步降低非零样本。  
   - 影响：区间代表性不足，得分偏差。  
   - 缓解：允许切换分档策略，日志提示分布偏度；保留用户区间强制入榜；可选按因子去重视图便于复核。
4) **评分与排序争议**：权重仅四项，无协同；样本按分位线性计分，可能高样本但收益低的区间排后。  
   - 影响：优先级可能与用户预期不同。  
   - 缓解：在报告中明确权重；如需可开放权重配置或提供备选排序（按收益/夏普）。
5) **用户区间合法性**：用户区间越界/重叠可能造成重复或无效结果。  
   - 影响：榜单重复行或空结果。  
   - 缓解：做范围校验与排序，重叠区间按得分排序；高亮标记；日志记录命中/跳过原因。
6) **默认开启的兼容性**：新开关默认开，若环境特殊（低性能或不需该功能）可能引起不必要耗时。  
   - 影响：运行时间增加。  
   - 缓解：保留开关可关闭；在说明书提示可关 `single_param_flex` 以提速。

## 建议与优先级
- **先行实现**：按方案落地（独立模块+配置+主流程挂钩），默认开启，但在说明书强调可关闭以提速。  
- **审计提示**：在报告/日志中输出过滤统计（样本不足、0 值单档数量、合并次数、用户区间命中）。  
- **可选增强（次优先级）**：分档策略切换、按因子去重视图与全量视图并列、权重可配置。  
- **验收要点**：  
  - 生成独立报告/CSV/XLSX，不影响旧报告；  
  - 样本下限=总样本/20 生效，0 值单档；  
  - 用户区间强制入榜且高亮；  
  - 过滤/合并/无结果情况有清晰提示。  
