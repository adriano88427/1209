# 三方案可行性与风险评估-Codex-20251207-1710

## 范围
- 方案 4A：IC 自校验（逐日 Spearman、日度明细、等权/加权对比）。
- 方案 4B：外部基准（Alphalens 优先，Qlib 备选）。
- 精确 Bootstrap：基于日度 IC 明细的重采样 CI。

## 可行性
- 4A：高。无新依赖；逻辑简单（分组计算、落盘对比）；可快速实现并运行，独立输出，不改主流程。  
- 4B：中。需安装/适配外部库（网络/权限/兼容性有不确定性）；数据格式需转换为 MultiIndex；执行成本较高，但可提供权威对照。  
- 精确 Bootstrap：中等。依赖日度 IC 明细（4A 的产物），实现简单（重采样），耗时可控（迭代可调），独立输出。

## 风险（细化）
- 4A 自校验：低  
  - 噪声风险：日样本偏小，单日 IC 波动大；若不过滤低样本/低唯一值，会放大差异。缓解：沿用主流程阈值，记录样本/唯一值并可设最小样本过滤。  
  - 逻辑偏差：若未对齐主流程的拼窗/去重/ winsor 规则，均值会有系统性差异。缓解：明示与主流程一致的过滤/窗口/去重策略；差异超阈值时核对日度明细。  
  - 性能/IO：日度明细文件较大但可控，影响小。
- 4B 外部基准：中高  
  - 依赖与环境：安装 Alphalens/Qlib 可能因网络/权限失败，或与现有包版本冲突。缓解：隔离环境（虚拟环境/容器）、先试 Alphalens，失败则回退本地基准。  
  - 数据格式偏差：日期/资产索引、收益对齐不当会带来结构性差异。缓解：严格按库要求构造 MultiIndex，使用与主流程同一收益列和对齐的信号日期。  
  - 输出偏差：库内默认分层/去极值/对齐窗口与主流程不同。缓解：关闭多余处理，仅做 IC；记录库端参数，必要时在报告注明。  
  - 耗时与资源：大数据量下计算慢。缓解：先跑核心因子、小样本试运行。
- 精确 Bootstrap：中  
  - 数据质量：依赖日度 IC 明细，若日数少或极值多，CI 会很宽。缓解：对日度明细设最小样本过滤，必要时 winsor。  
  - 权重策略差异：等权 vs 样本权选择影响 CI，与主流程策略需对齐。缓解：同时输出两种或明确记录所用策略。  
  - 耗时：高迭代会耗时。缓解：先小迭代（如 1000）试跑，再视需要提升。  
  - 解释成本：CI 差异需结合日度样本与极值情况解释，可能增加分析时间。

## 建议
- 优先执行 4A，先拿到日度明细与自校验对比，作为基准检查。  
- 在 4A 明细可用的前提下，再做精确 Bootstrap，对主流程 CI 做独立验证；迭代先小后大。  
- 4B 视环境与需求选择：需要对外权威背书或多维诊断时再安装 Alphalens；若环境受限，先暂缓。  
- 发现差异时，先用 4A 明细核对样本/唯一值/窗口逻辑，再决定是否调整主流程或仅在验证层兼容。***
